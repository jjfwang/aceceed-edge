{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});class OpenAiClient{constructor(config,logger){this.config=config;this.logger=logger}static{__name(this,\"OpenAiClient\")}async generate(messages){const temperature=this.config.cloud.temperature??this.config.local.temperature;const maxTokens=this.config.cloud.maxTokens??256;const timeoutMs=this.config.cloud.requestTimeoutMs??1e4;const retries=2;const apiKey=process.env[this.config.cloud.apiKeyEnv];if(!apiKey){throw new Error(`Missing API key in env ${this.config.cloud.apiKeyEnv}`)}const baseUrl=this.config.cloud.baseUrl??\"https://api.openai.com/v1\";const normalizedBase=baseUrl.endsWith(\"/\")?baseUrl:`${baseUrl}/`;const url=new URL(\"chat/completions\",normalizedBase);let lastError;for(let attempt=0;attempt<=retries;attempt++){const controller=new AbortController;const timer=setTimeout(()=>controller.abort(),timeoutMs);try{const response=await fetch(url,{method:\"POST\",headers:{\"Content-Type\":\"application/json\",Authorization:`Bearer ${apiKey}`},body:JSON.stringify({model:this.config.cloud.model,temperature,max_tokens:maxTokens,messages}),signal:controller.signal});clearTimeout(timer);if(!response.ok){const body=await response.text();throw new Error(`OpenAI API error: ${response.status} ${body}`)}const data=await response.json();const content=data.choices?.[0]?.message?.content?.trim();if(!content){this.logger.warn({data},\"Empty response from OpenAI-compatible API\");return\"\"}return content}catch(err){clearTimeout(timer);lastError=err;if(attempt===retries){break}const backoffMs=200*Math.pow(2,attempt);await new Promise(resolve=>setTimeout(resolve,backoffMs))}}throw lastError??new Error(\"OpenAI API request failed\")}}export{OpenAiClient};\n","warnings":[],"map":{"version":3,"mappings":"kHAQO,MAAM,YAAkC,CAC7C,YAAoB,OAA2B,OAAgB,CAA3C,mBAA2B,kBAAiB,CATlE,MAQ+C,6BAG7C,MAAM,SAAS,SAA0C,CACvD,MAAM,YAAc,KAAK,OAAO,MAAM,aAAe,KAAK,OAAO,MAAM,YACvE,MAAM,UAAY,KAAK,OAAO,MAAM,WAAa,IACjD,MAAM,UAAY,KAAK,OAAO,MAAM,kBAAoB,IACxD,MAAM,QAAU,EAEhB,MAAM,OAAS,QAAQ,IAAI,KAAK,OAAO,MAAM,SAAS,EACtD,GAAI,CAAC,OAAQ,CACX,MAAM,IAAI,MAAM,0BAA0B,KAAK,OAAO,MAAM,SAAS,EAAE,CACzE,CAEA,MAAM,QAAU,KAAK,OAAO,MAAM,SAAW,4BAC7C,MAAM,eAAiB,QAAQ,SAAS,GAAG,EAAI,QAAU,GAAG,OAAO,IACnE,MAAM,IAAM,IAAI,IAAI,mBAAoB,cAAc,EAEtD,IAAI,UACJ,QAAS,QAAU,EAAG,SAAW,QAAS,UAAW,CACnD,MAAM,WAAa,IAAI,gBACvB,MAAM,MAAQ,WAAW,IAAM,WAAW,MAAM,EAAG,SAAS,EAC5D,GAAI,CACF,MAAM,SAAW,MAAM,MAAM,IAAK,CAChC,OAAQ,OACR,QAAS,CACP,eAAgB,mBAChB,cAAe,UAAU,MAAM,EACjC,EACA,KAAM,KAAK,UAAU,CACnB,MAAO,KAAK,OAAO,MAAM,MACzB,YACA,WAAY,UACZ,QACF,CAAC,EACD,OAAQ,WAAW,MACrB,CAAC,EAED,aAAa,KAAK,EAElB,GAAI,CAAC,SAAS,GAAI,CAChB,MAAM,KAAO,MAAM,SAAS,KAAK,EACjC,MAAM,IAAI,MAAM,qBAAqB,SAAS,MAAM,IAAI,IAAI,EAAE,CAChE,CAEA,MAAM,KAAQ,MAAM,SAAS,KAAK,EAClC,MAAM,QAAU,KAAK,UAAU,CAAC,GAAG,SAAS,SAAS,KAAK,EAC1D,GAAI,CAAC,QAAS,CACZ,KAAK,OAAO,KAAK,CAAE,IAAK,EAAG,2CAA2C,EACtE,MAAO,EACT,CACA,OAAO,OACT,OAAS,IAAK,CACZ,aAAa,KAAK,EAClB,UAAY,IACZ,GAAI,UAAY,QAAS,CACvB,KACF,CACA,MAAM,UAAY,IAAM,KAAK,IAAI,EAAG,OAAO,EAC3C,MAAM,IAAI,QAAS,SAAY,WAAW,QAAS,SAAS,CAAC,CAC/D,CACF,CAEA,MAAM,WAAa,IAAI,MAAM,2BAA2B,CAC1D,CACF","names":[],"ignoreList":[],"sources":["/home/pi/aceceed-edge/apps/src/llm/openaiApi.ts"],"sourcesContent":[null]}}