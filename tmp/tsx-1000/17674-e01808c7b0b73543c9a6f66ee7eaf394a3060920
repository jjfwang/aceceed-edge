{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{promises as fs}from\"node:fs\";import{runCommand,safeUnlink,tempPath}from\"../../common/utils.js\";class WhisperCppStt{constructor(config,logger){this.config=config;this.logger=logger}static{__name(this,\"WhisperCppStt\")}async transcribe(audioPath){const outPrefix=tempPath(\"whisper\",\"\");const outputTxt=`${outPrefix}.txt`;const args=[\"-m\",this.config.whispercpp.modelPath,\"-f\",audioPath,\"-otxt\",\"-of\",outPrefix];if(this.config.whispercpp.language){args.push(\"-l\",this.config.whispercpp.language)}try{await runCommand(this.config.whispercpp.binPath,args)}catch(err){throw new Error(`whisper.cpp failed. Check binPath '${this.config.whispercpp.binPath}' and modelPath '${this.config.whispercpp.modelPath}'.`)}const text=await fs.readFile(outputTxt,\"utf-8\");await safeUnlink(outputTxt);const cleaned=text.replace(/\\s+/g,\" \").trim();if(!cleaned){this.logger.warn(\"Empty transcript from whisper.cpp\")}return cleaned}}export{WhisperCppStt};\n","warnings":[],"map":{"version":3,"mappings":"kHAAA,OAAS,YAAY,OAAU,UAG/B,OAAS,WAAY,WAAY,aAAgB,wBAG1C,MAAM,aAAqC,CAChD,YAAoB,OAA2B,OAAgB,CAA3C,mBAA2B,kBAAiB,CAPlE,MAMkD,8BAGhD,MAAM,WAAW,UAAoC,CACnD,MAAM,UAAY,SAAS,UAAW,EAAE,EACxC,MAAM,UAAY,GAAG,SAAS,OAE9B,MAAM,KAAO,CACX,KACA,KAAK,OAAO,WAAW,UACvB,KACA,UACA,QACA,MACA,SACF,EAEA,GAAI,KAAK,OAAO,WAAW,SAAU,CACnC,KAAK,KAAK,KAAM,KAAK,OAAO,WAAW,QAAQ,CACjD,CAEA,GAAI,CACF,MAAM,WAAW,KAAK,OAAO,WAAW,QAAS,IAAI,CACvD,OAAS,IAAK,CACZ,MAAM,IAAI,MACR,sCAAsC,KAAK,OAAO,WAAW,OAAO,oBAAoB,KAAK,OAAO,WAAW,SAAS,IAC1H,CACF,CAEA,MAAM,KAAO,MAAM,GAAG,SAAS,UAAW,OAAO,EACjD,MAAM,WAAW,SAAS,EAE1B,MAAM,QAAU,KAAK,QAAQ,OAAQ,GAAG,EAAE,KAAK,EAC/C,GAAI,CAAC,QAAS,CACZ,KAAK,OAAO,KAAK,mCAAmC,CACtD,CACA,OAAO,OACT,CACF","names":[],"ignoreList":[],"sources":["/home/pi/aceceed-edge/apps/src/audio/stt/whisperCpp.ts"],"sourcesContent":[null]}}