{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{cameraResponseSchema,errorResponseSchema,pttStartRequestSchema,runtimeServicesResponseSchema,pttStartResponseSchema,pttStopResponseSchema}from\"./schemas.js\";function registerRoutes(server,runtime,bus){server.post(\"/v1/ptt/start\",{schema:{body:pttStartRequestSchema,response:{200:pttStartResponseSchema,409:errorResponseSchema,500:errorResponseSchema}}},async(req,reply)=>{if(runtime.isPttActive()){return reply.code(409).send({status:\"error\",message:\"PTT already active\"})}try{const requestedAgent=req.body?.agent;bus.publish({type:\"ptt:start\",source:\"api\"});const result=await runtime.handlePttStart(\"api\",requestedAgent);return{status:\"completed\",transcript:result?.transcript??\"\",response:result?.response??\"\"}}catch(err){return reply.code(500).send({status:\"error\",message:err.message??\"PTT failed\"})}});server.post(\"/v1/ptt/stop\",{schema:{response:{200:pttStopResponseSchema,409:errorResponseSchema}}},async(_req,reply)=>{if(!runtime.isPttActive()){return reply.code(409).send({status:\"error\",message:\"No active PTT session\"})}bus.publish({type:\"ptt:stop\",source:\"api\"});runtime.handlePttStop();return{status:\"stopped\"}});server.post(\"/v1/camera/capture\",{schema:{response:{200:cameraResponseSchema}}},async()=>{const result=await runtime.captureWithDetectors(\"api\");const motionScore=result.detectors.length>0?Math.max(...result.detectors.map(detector=>detector.motionScore)):0;return{paperPresent:result.detectors.some(detector=>detector.paperPresent),motionScore,imageBytes:result.capture.length,detectors:result.detectors}});server.get(\"/v1/runtime/services\",{schema:{response:{200:runtimeServicesResponseSchema}}},async()=>{return{services:runtime.getServiceStatus()}})}__name(registerRoutes,\"registerRoutes\");export{registerRoutes};\n","warnings":[],"map":{"version":3,"mappings":"kHAGA,OACE,qBACA,oBACA,sBACA,8BACA,uBACA,0BACK,eAEA,SAAS,eAAe,OAAyB,QAAqB,IAAe,CAC1F,OAAO,KACL,gBACA,CACE,OAAQ,CACN,KAAM,sBACN,SAAU,CAAE,IAAK,uBAAwB,IAAK,oBAAqB,IAAK,mBAAoB,CAC9F,CACF,EACA,MAAO,IAAK,QAAU,CACpB,GAAI,QAAQ,YAAY,EAAG,CACzB,OAAO,MAAM,KAAK,GAAG,EAAE,KAAK,CAAE,OAAQ,QAAS,QAAS,oBAAqB,CAAC,CAChF,CACA,GAAI,CACF,MAAM,eAAkB,IAAI,MAAyC,MACrE,IAAI,QAAQ,CAAE,KAAM,YAAa,OAAQ,KAAM,CAAC,EAChD,MAAM,OAAS,MAAM,QAAQ,eAAe,MAAO,cAAc,EACjE,MAAO,CACL,OAAQ,YACR,WAAY,QAAQ,YAAc,GAClC,SAAU,QAAQ,UAAY,EAChC,CACF,OAAS,IAAK,CACZ,OAAO,MACJ,KAAK,GAAG,EACR,KAAK,CAAE,OAAQ,QAAS,QAAU,IAAc,SAAW,YAAa,CAAC,CAC9E,CACF,CACF,EAEA,OAAO,KACL,eACA,CACE,OAAQ,CAAE,SAAU,CAAE,IAAK,sBAAuB,IAAK,mBAAoB,CAAE,CAC/E,EACA,MAAO,KAAM,QAAU,CACrB,GAAI,CAAC,QAAQ,YAAY,EAAG,CAC1B,OAAO,MAAM,KAAK,GAAG,EAAE,KAAK,CAAE,OAAQ,QAAS,QAAS,uBAAwB,CAAC,CACnF,CACA,IAAI,QAAQ,CAAE,KAAM,WAAY,OAAQ,KAAM,CAAC,EAC/C,QAAQ,cAAc,EACtB,MAAO,CAAE,OAAQ,SAAU,CAC7B,CACF,EAEA,OAAO,KACL,qBACA,CACE,OAAQ,CAAE,SAAU,CAAE,IAAK,oBAAqB,CAAE,CACpD,EACA,SAAY,CACV,MAAM,OAAS,MAAM,QAAQ,qBAAqB,KAAK,EACvD,MAAM,YACJ,OAAO,UAAU,OAAS,EACtB,KAAK,IAAI,GAAG,OAAO,UAAU,IAAK,UAAa,SAAS,WAAW,CAAC,EACpE,EACN,MAAO,CACL,aAAc,OAAO,UAAU,KAAM,UAAa,SAAS,YAAY,EACvE,YACA,WAAY,OAAO,QAAQ,OAC3B,UAAW,OAAO,SACpB,CACF,CACF,EAEA,OAAO,IACL,uBACA,CACE,OAAQ,CAAE,SAAU,CAAE,IAAK,6BAA8B,CAAE,CAC7D,EACA,SAAY,CACV,MAAO,CAAE,SAAU,QAAQ,iBAAiB,CAAE,CAChD,CACF,CACF,CA1EgB","names":[],"ignoreList":[],"sources":["/home/pi/aceceed-edge/apps/src/api/routes.ts"],"sourcesContent":[null]}}