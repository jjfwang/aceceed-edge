{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});function detectResponseLanguage(transcript){if(/[\\u4E00-\\u9FFF]/.test(transcript)){return{label:\"Simplified Chinese\"}}if(/[\\u3040-\\u30FF]/.test(transcript)){return{label:\"Japanese\"}}if(/[\\uAC00-\\uD7AF]/.test(transcript)){return{label:\"Korean\"}}return null}__name(detectResponseLanguage,\"detectResponseLanguage\");function stripLanguagePrefix(response){const trimmed=response.trim();const patterns=[/^answer\\s*[:：]\\s*/i,/^response\\s*[:：]\\s*/i,/^final\\s*[:：]\\s*/i];for(const pattern of patterns){if(pattern.test(trimmed)){return trimmed.replace(pattern,\"\").trim()}}return trimmed}__name(stripLanguagePrefix,\"stripLanguagePrefix\");function buildSystemPrompt(base,language){if(!language){return base}return[base,`Respond only in ${language}. Do not translate or switch languages.`,\"Do not add prefatory labels like 'Answer:' or language names.\"].filter(Boolean).join(\"\\n\")}__name(buildSystemPrompt,\"buildSystemPrompt\");class CoachAgent{constructor(llm,systemPrompt,logger){this.llm=llm;this.systemPrompt=systemPrompt;this.logger=logger}static{__name(this,\"CoachAgent\")}id=\"coach\";name=\"Coach\";async handle(input){if(!input.transcript.trim()){return null}const languageHint=detectResponseLanguage(input.transcript);const finalPrompt=buildSystemPrompt(this.systemPrompt,languageHint?.label??null);const messages=[{role:\"system\",content:finalPrompt},{role:\"user\",content:input.transcript}];if(this.logger){this.logger.info({messages},\"Coach LLM request\")}const response=await this.llm.generate(messages);if(this.logger){this.logger.info({response},\"Coach LLM response\")}return{text:stripLanguagePrefix(response)}}}export{CoachAgent};\n","warnings":[],"map":{"version":3,"mappings":"kHAIA,SAAS,uBAAuB,WAA8C,CAC5E,GAAI,kBAAkB,KAAK,UAAU,EAAG,CACtC,MAAO,CAAE,MAAO,oBAAqB,CACvC,CACA,GAAI,kBAAkB,KAAK,UAAU,EAAG,CACtC,MAAO,CAAE,MAAO,UAAW,CAC7B,CACA,GAAI,kBAAkB,KAAK,UAAU,EAAG,CACtC,MAAO,CAAE,MAAO,QAAS,CAC3B,CACA,OAAO,IACT,CAXS,wDAaT,SAAS,oBAAoB,SAA0B,CACrD,MAAM,QAAU,SAAS,KAAK,EAC9B,MAAM,SAAW,CAAC,qBAAsB,uBAAwB,mBAAmB,EACnF,UAAW,WAAW,SAAU,CAC9B,GAAI,QAAQ,KAAK,OAAO,EAAG,CACzB,OAAO,QAAQ,QAAQ,QAAS,EAAE,EAAE,KAAK,CAC3C,CACF,CACA,OAAO,OACT,CATS,kDAWT,SAAS,kBAAkB,KAAc,SAAiC,CACxE,GAAI,CAAC,SAAU,CACb,OAAO,IACT,CACA,MAAO,CACL,KACA,mBAAmB,QAAQ,0CAC3B,+DACF,EAAE,OAAO,OAAO,EAAE,KAAK,IAAI,CAC7B,CATS,8CAWF,MAAM,UAA4B,CAIvC,YACU,IACA,aACA,OACR,CAHQ,aACA,+BACA,kBACP,CA/CL,MAuCyC,2BACvC,GAAK,QACL,KAAO,QAQP,MAAM,OAAO,MAAgD,CAC3D,GAAI,CAAC,MAAM,WAAW,KAAK,EAAG,CAC5B,OAAO,IACT,CAEA,MAAM,aAAe,uBAAuB,MAAM,UAAU,EAC5D,MAAM,YAAc,kBAAkB,KAAK,aAAc,cAAc,OAAS,IAAI,EAEpF,MAAM,SAAW,CACf,CAAE,KAAM,SAAU,QAAS,WAAY,EACvC,CAAE,KAAM,OAAQ,QAAS,MAAM,UAAW,CAC5C,EAEA,GAAI,KAAK,OAAQ,CACf,KAAK,OAAO,KAAK,CAAE,QAAS,EAAG,mBAAmB,CACpD,CAEA,MAAM,SAAW,MAAM,KAAK,IAAI,SAAS,QAAQ,EAEjD,GAAI,KAAK,OAAQ,CACf,KAAK,OAAO,KAAK,CAAE,QAAS,EAAG,oBAAoB,CACrD,CAEA,MAAO,CAAE,KAAM,oBAAoB,QAAQ,CAAE,CAC/C,CACF","names":[],"ignoreList":[],"sources":["/home/pi/aceceed-edge/apps/src/agents/coachAgent.ts"],"sourcesContent":[null]}}