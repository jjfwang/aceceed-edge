{"code":"var __defProp=Object.defineProperty;var __name=(target,value)=>__defProp(target,\"name\",{value,configurable:true});import{promises as fs}from\"node:fs\";import{runCommand,safeUnlink,tempPath}from\"../common/utils.js\";class VisionCapture{constructor(config,logger){this.config=config;this.logger=logger}static{__name(this,\"VisionCapture\")}async captureStill(){if(!this.config.enabled){throw new Error(\"Vision is disabled\")}if(this.config.capture.backend===\"camera-service\"){if(!this.config.capture.cameraServiceUrl){throw new Error(\"cameraServiceUrl is required for camera-service backend\")}const url=new URL(\"/capture\",this.config.capture.cameraServiceUrl);const response=await fetch(url,{method:\"POST\"});if(!response.ok){throw new Error(`Camera service error: ${response.status}`)}const arrayBuffer=await response.arrayBuffer();return{image:Buffer.from(arrayBuffer),mimeType:\"image/jpeg\"}}const outputPath=tempPath(\"camera\",\".jpg\");const baseArgs=[\"--nopreview\",\"--timeout\",\"100\",\"--output\",outputPath];const args=[...baseArgs,...this.config.capture.stillArgs];const command=this.config.capture.backend===\"rpicam-still\"?\"rpicam-still\":\"libcamera-still\";try{await runCommand(command,args)}catch(err){throw new Error(`Camera capture failed. Ensure '${command}' is installed and the camera is enabled.`)}const image=await fs.readFile(outputPath);await safeUnlink(outputPath);return{image,mimeType:\"image/jpeg\"}}}export{VisionCapture};\n","warnings":[],"map":{"version":3,"mappings":"kHAAA,OAAS,YAAY,OAAU,UAG/B,OAAS,WAAY,WAAY,aAAgB,qBAE1C,MAAM,aAAc,CACzB,YAAoB,OAA8B,OAAgB,CAA9C,mBAA8B,kBAAiB,CANrE,MAK2B,8BAGzB,MAAM,cAA6C,CACjD,GAAI,CAAC,KAAK,OAAO,QAAS,CACxB,MAAM,IAAI,MAAM,oBAAoB,CACtC,CAEA,GAAI,KAAK,OAAO,QAAQ,UAAY,iBAAkB,CACpD,GAAI,CAAC,KAAK,OAAO,QAAQ,iBAAkB,CACzC,MAAM,IAAI,MAAM,yDAAyD,CAC3E,CACA,MAAM,IAAM,IAAI,IAAI,WAAY,KAAK,OAAO,QAAQ,gBAAgB,EACpE,MAAM,SAAW,MAAM,MAAM,IAAK,CAAE,OAAQ,MAAO,CAAC,EACpD,GAAI,CAAC,SAAS,GAAI,CAChB,MAAM,IAAI,MAAM,yBAAyB,SAAS,MAAM,EAAE,CAC5D,CACA,MAAM,YAAc,MAAM,SAAS,YAAY,EAC/C,MAAO,CACL,MAAO,OAAO,KAAK,WAAW,EAC9B,SAAU,YACZ,CACF,CAEA,MAAM,WAAa,SAAS,SAAU,MAAM,EAC5C,MAAM,SAAW,CAAC,cAAe,YAAa,MAAO,WAAY,UAAU,EAC3E,MAAM,KAAO,CAAC,GAAG,SAAU,GAAG,KAAK,OAAO,QAAQ,SAAS,EAE3D,MAAM,QACJ,KAAK,OAAO,QAAQ,UAAY,eAAiB,eAAiB,kBAEpE,GAAI,CACF,MAAM,WAAW,QAAS,IAAI,CAChC,OAAS,IAAK,CACZ,MAAM,IAAI,MACR,kCAAkC,OAAO,2CAC3C,CACF,CAEA,MAAM,MAAQ,MAAM,GAAG,SAAS,UAAU,EAC1C,MAAM,WAAW,UAAU,EAE3B,MAAO,CACL,MACA,SAAU,YACZ,CACF,CACF","names":[],"ignoreList":[],"sources":["/home/pi/aceceed-edge/apps/src/vision/capture.ts"],"sourcesContent":[null]}}